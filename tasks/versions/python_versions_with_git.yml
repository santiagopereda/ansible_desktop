---
- name: get vars
  include_vars:
    dir: ../../vars

- name: source.zshrc
  become: true
  become_user: "{{ base_user }}"
  shell: "source {{ pyenv_zshrc_path }}"
  args:
    executable: "{{ pyenv_install_shell | default(omit) }}"
  environment:
    PATH: "/bin/zsh:{{ ansible_env.SHELL }}" 
    
- name: set SHELL
  become: true
  become_user: "{{ base_user }}"
  ansible.builtin.set_fact:
    shell: "{{ lookup('env','SHELL') }}"
  args:
    executable: /bin/zsh
  environment:
    PATH: "/bin/zsh:{{ ansible_env.SHELL }}" 

- debug:
    msg: '{{ shell }}'

- name: python source
  become: true
  become_user: "{{ base_user }}"
  shell: "exec /bin/zsh"
  args:
    executable: "{{ pyenv_install_shell }}"
  environment:
    PATH: "/bin/zsh:{{ ansible_env.SHELL }}" 
  register: pyenv_root_output

- name: Install Python interpreters
  become: true
  become_user: "{{base_user}}"
  shell: "{{ pyenv_bin_path }} install {{ item }}"
  args:
    executable: "{{ pyenv_install_shell | default(omit) }}"
    creates: "$HOME/.config/pyenv/versions/{{ item }}/bin/python"
  with_items: "{{ pyenv_python_versions }}"
  environment:
    PATH: "/bin/zsh:{{ ansible_env.SHELL }}"